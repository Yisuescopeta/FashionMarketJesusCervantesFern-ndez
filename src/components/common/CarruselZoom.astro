---
interface Props {
  images: string[];
  alt: string;
}

const { images, alt } = Astro.props;
---

<!-- Modal de Galería de Imágenes -->
<div
  id="gallery-modal"
  class="fixed inset-0 z-[999]"
  style="display: none; background: white;"
>
  <!-- Botón Cerrar -->
  <button
    onclick="document.getElementById('gallery-modal').style.display='none'; document.body.style.overflow='';"
    class="absolute top-6 right-6 z-50 w-14 h-14 bg-gray-100 hover:bg-gray-200 rounded-full flex items-center justify-center text-3xl font-light"
  >
    ×
  </button>

  <!-- Contenedor de Imágenes -->
  <div
    id="gallery-images"
    class="w-full h-full flex overflow-x-auto snap-x snap-mandatory"
    style="scrollbar-width: none; -ms-overflow-style: none;"
  >
    {
      images && images.length > 0 ? (
        images.map((img, index) => (
          <div
            class="gallery-item flex-shrink-0 w-full md:w-1/2 lg:w-1/3 h-full snap-center flex items-center justify-center p-8"
            style="background: #f8f8f8;"
          >
            <img
              src={img}
              alt={`${alt} - Vista ${index + 1}`}
              class="max-w-full max-h-[85vh] object-contain"
              style="box-shadow: 0 10px 40px rgba(0,0,0,0.1);"
              loading="eager"
            />
          </div>
        ))
      ) : (
        <div class="w-full h-full flex items-center justify-center text-gray-400 text-xl">
          <p>No hay imágenes disponibles</p>
        </div>
      )
    }
  </div>

  <!-- Controles de Navegación -->
  <div
    class="absolute bottom-8 left-8 flex bg-white shadow-xl border border-gray-200"
  >
    <button
      id="gallery-prev"
      class="p-5 hover:bg-gray-100 border-r border-gray-200 transition-colors"
    >
      <svg
        width="20"
        height="20"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"><polyline points="15 18 9 12 15 6"></polyline></svg
      >
    </button>
    <button id="gallery-next" class="p-5 hover:bg-gray-100 transition-colors">
      <svg
        width="20"
        height="20"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"><polyline points="9 18 15 12 9 6"></polyline></svg
      >
    </button>
  </div>

  <!-- Indicador de imágenes -->
  <div
    class="absolute bottom-10 right-8 bg-white px-4 py-2 shadow-lg border border-gray-200 text-sm font-medium"
  >
    <span id="gallery-current">1</span> / {images.length}
  </div>
</div>

<style>
  #gallery-images::-webkit-scrollbar {
    display: none;
  }
</style>

<script is:inline>
  // Función global para abrir la galería
  window.openCarrusel = function (index) {
    index = index || 0;
    var modal = document.getElementById("gallery-modal");
    var container = document.getElementById("gallery-images");

    if (!modal || !container) {
      console.error("Modal o contenedor no encontrado");
      return;
    }

    modal.style.display = "block";
    document.body.style.overflow = "hidden";

    // Scroll a la imagen indicada
    var items = container.querySelectorAll(".gallery-item");
    if (items[index]) {
      setTimeout(function () {
        items[index].scrollIntoView({ behavior: "instant", inline: "start" });
      }, 50);
    }

    window._currentGalleryIndex = index;
    updateGalleryIndicator();
  };

  window._currentGalleryIndex = 0;

  function updateGalleryIndicator() {
    var indicator = document.getElementById("gallery-current");
    if (indicator) {
      indicator.textContent = (window._currentGalleryIndex + 1).toString();
    }
  }

  // Navegación con botones
  document.addEventListener("click", function (e) {
    var container = document.getElementById("gallery-images");
    if (!container) return;

    var items = container.querySelectorAll(".gallery-item");

    if (e.target.closest("#gallery-prev")) {
      window._currentGalleryIndex = Math.max(
        0,
        window._currentGalleryIndex - 1,
      );
      if (items[window._currentGalleryIndex]) {
        items[window._currentGalleryIndex].scrollIntoView({
          behavior: "smooth",
          inline: "start",
        });
      }
      updateGalleryIndicator();
    }

    if (e.target.closest("#gallery-next")) {
      window._currentGalleryIndex = Math.min(
        items.length - 1,
        window._currentGalleryIndex + 1,
      );
      if (items[window._currentGalleryIndex]) {
        items[window._currentGalleryIndex].scrollIntoView({
          behavior: "smooth",
          inline: "start",
        });
      }
      updateGalleryIndicator();
    }
  });

  // Cerrar con Escape
  document.addEventListener("keydown", function (e) {
    if (e.key === "Escape") {
      var modal = document.getElementById("gallery-modal");
      if (modal && modal.style.display !== "none") {
        modal.style.display = "none";
        document.body.style.overflow = "";
      }
    }
  });
</script>
